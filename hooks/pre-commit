#!/bin/sh
# Auto-update CACHE_NAME in sw.js with a content hash for cache busting
HASH=$(cat index.html style.css game.js | shasum | cut -c1-7)
CURRENT=$(grep "^const CACHE_NAME" sw.js)

# Only update if the hash changed
if echo "$CURRENT" | grep -q "$HASH"; then
  exit 0
fi

sed -i '' "s/^const CACHE_NAME = .*/const CACHE_NAME = 'retris-${HASH}';/" sw.js
git add sw.js
